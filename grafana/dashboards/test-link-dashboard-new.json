{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "graphTooltip": 0,
  "id": 0,
  "links": [],
  "panels": [

    {
      "type": "row",
      "id": 1,
      "title": "PICK SLA BREACH",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 }
    },

    {
      "id": 2,
      "type": "barchart",
      "title": "Pick SLA Breach Trend (5-Min)",
      "datasource": "${ds}",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 1 },
      "fieldConfig": {
        "defaults": { "color": { "mode": "fixed" } },
        "overrides": [
          { "matcher": { "id": "byName", "options": "Delayed" }, "properties": [{ "id": "color", "value": { "mode": "fixed", "fixedColor": "red" } }] },
          { "matcher": { "id": "byName", "options": "Moving Slow" }, "properties": [{ "id": "color", "value": { "mode": "fixed", "fixedColor": "yellow" } }] }
        ]
      },
      "targets": [
        {
          "rawQuery": true,
          "format": "time_series",
          "rawSql": "SELECT bucket AS time, sla_status AS metric, order_count AS value FROM sla_pick_status_5min_mv WHERE sla_status IN ('Delayed','Moving Slow') AND breach_scope='${breach_scope}' AND order_type ~ '${order_type}' AND $__timeFilter(bucket)",
          "refId": "A"
        }
      ]
    },

    {
      "id": 3,
      "type": "table",
      "title": "Pick SLA – Order Details",
      "datasource": "${ds}",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 1 },
      "fieldConfig": {
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "status" },
            "properties": [
              { "id": "custom.cellOptions", "value": { "applyToRow": true, "type": "color-background" } },
              {
                "id": "mappings",
                "value": [
                  { "type": "value", "options": { "Delayed": { "color": "red" }, "Moving Slow": { "color": "yellow" } } }
                ]
              }
            ]
          }
        ]
      },
      "targets": [
        {
          "rawQuery": true,
          "format": "table",
          "rawSql": "SELECT order_type, pick_breach_state AS status, COUNT(*) AS count FROM order_sla_breach_reporting WHERE pick_breach_state IN ('Delayed','Moving Slow') AND breach_scope='${breach_scope}' AND order_type ~ '${order_type}' GROUP BY order_type, pick_breach_state",
          "refId": "A"
        }
      ]
    },

    {
      "type": "row",
      "id": 4,
      "title": "STAGE STARTED SLA BREACH (PCK → OSC)",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 9 }
    },

    {
      "id": 5,
      "type": "barchart",
      "title": "Stage Started SLA Breach Trend (5-Min)",
      "datasource": "${ds}",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 10 },
      "fieldConfig": {
        "defaults": { "color": { "mode": "fixed" } },
        "overrides": [
          { "matcher": { "id": "byName", "options": "Delayed" }, "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "Moving Slow" }, "properties": [{ "id": "color", "value": { "fixedColor": "yellow", "mode": "fixed" } }] }
        ]
      },
      "targets": [
        {
          "rawQuery": true,
          "format": "time_series",
          "rawSql": "SELECT bucket AS time, sla_status AS metric, order_count AS value FROM sla_stage_started_status_5min_mv WHERE sla_status IN ('Delayed','Moving Slow') AND breach_scope='${breach_scope}' AND order_type ~ '${order_type}' AND $__timeFilter(bucket)",
          "refId": "A"
        }
      ]
    },

    {
      "id": 6,
      "type": "table",
      "title": "Stage Started SLA – Order Details",
      "datasource": "${ds}",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 10 },
      "fieldConfig": {
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "status" },
            "properties": [
              { "id": "custom.cellOptions", "value": { "applyToRow": true, "type": "color-background" } },
              {
                "id": "mappings",
                "value": [
                  { "type": "value", "options": { "Delayed": { "color": "red" }, "Moving Slow": { "color": "yellow" } } }
                ]
              }
            ]
          }
        ]
      },
      "targets": [
        {
          "rawQuery": true,
          "format": "table",
          "rawSql": "SELECT order_type, stage_started_breach_state AS status, COUNT(*) AS count FROM order_sla_breach_reporting WHERE stage_started_breach_state IN ('Delayed','Moving Slow') AND breach_scope='${breach_scope}' AND order_type ~ '${order_type}' GROUP BY order_type, stage_started_breach_state",
          "refId": "A"
        }
      ]
    },

    {
      "type": "row",
      "id": 7,
      "title": "STAGE COMPLETED SLA BREACH (OSC → SPK)",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 18 }
    },

    {
      "id": 8,
      "type": "barchart",
      "title": "Stage Completed SLA Breach Trend (5-Min)",
      "datasource": "${ds}",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 19 },
      "fieldConfig": {
        "defaults": { "color": { "mode": "fixed" } },
        "overrides": [
          { "matcher": { "id": "byName", "options": "Delayed" }, "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "Moving Slow" }, "properties": [{ "id": "color", "value": { "fixedColor": "yellow", "mode": "fixed" } }] }
        ]
      },
      "targets": [
        {
          "rawQuery": true,
          "format": "time_series",
          "rawSql": "SELECT bucket AS time, sla_status AS metric, order_count AS value FROM sla_stage_status_5min_mv WHERE sla_status IN ('Delayed','Moving Slow') AND breach_scope='${breach_scope}' AND order_type ~ '${order_type}' AND $__timeFilter(bucket)",
          "refId": "A"
        }
      ]
    },

    {
      "id": 9,
      "type": "table",
      "title": "Stage Completed SLA – Order Details",
      "datasource": "${ds}",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 19 },
      "fieldConfig": {
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "status" },
            "properties": [
              { "id": "custom.cellOptions", "value": { "applyToRow": true, "type": "color-background" } },
              {
                "id": "mappings",
                "value": [
                  { "type": "value", "options": { "Delayed": { "color": "red" }, "Moving Slow": { "color": "yellow" } } }
                ]
              }
            ]
          }
        ]
      },
      "targets": [
        {
          "rawQuery": true,
          "format": "table",
          "rawSql": "SELECT order_type, stage_complete_breach_state AS status, COUNT(*) AS count FROM order_sla_breach_reporting WHERE stage_complete_breach_state IN ('Delayed','Moving Slow') AND breach_scope='${breach_scope}' AND order_type ~ '${order_type}' GROUP BY order_type, stage_complete_breach_state",
          "refId": "A"
        }
      ]
    },

    {
      "type": "row",
      "id": 10,
      "title": "SHIP SLA BREACH",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 27 }
    },

    {
      "id": 11,
      "type": "barchart",
      "title": "Ship SLA Breach Trend (5-Min)",
      "datasource": "${ds}",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 28 },
      "fieldConfig": {
        "defaults": { "color": { "mode": "fixed" } },
        "overrides": [
          { "matcher": { "id": "byName", "options": "Delayed" }, "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "Moving Slow" }, "properties": [{ "id": "color", "value": { "fixedColor": "yellow", "mode": "fixed" } }] }
        ]
      },
      "targets": [
        {
          "rawQuery": true,
          "format": "time_series",
          "rawSql": "SELECT bucket AS time, sla_status AS metric, order_count AS value FROM sla_ship_status_5min_mv WHERE sla_status IN ('Delayed','Moving Slow') AND breach_scope='${breach_scope}' AND order_type ~ '${order_type}' AND $__timeFilter(bucket)",
          "refId": "A"
        }
      ]
    },

    {
      "id": 12,
      "type": "table",
      "title": "Ship SLA – Order Details",
      "datasource": "${ds}",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 28 },
      "fieldConfig": {
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "status" },
            "properties": [
              { "id": "custom.cellOptions", "value": { "applyToRow": true, "type": "color-background" } },
              {
                "id": "mappings",
                "value": [
                  { "type": "value", "options": { "Delayed": { "color": "red" }, "Moving Slow": { "color": "yellow" } } }
                ]
              }
            ]
          }
        ]
      },
      "targets": [
        {
          "rawQuery": true,
          "format": "table",
          "rawSql": "SELECT order_type, ship_breach_state AS status, COUNT(*) AS count FROM order_sla_breach_reporting WHERE ship_breach_state IN ('Delayed','Moving Slow') AND breach_scope='${breach_scope}' AND order_type ~ '${order_type}' GROUP BY order_type, ship_breach_state",
          "refId": "A"
        }
      ]
    }
  ],
  "refresh": "5m",
  "schemaVersion": 42,
  "templating": {
    "list": [
      {
        "name": "ds",
        "type": "datasource",
        "query": "postgres",
        "current": { "text": "TimescaleDB", "value": "P40AE60E18F02DE32" }
      },
      {
        "name": "order_type",
        "type": "query",
        "datasource": "${ds}",
        "includeAll": true,
        "allValue": ".*",
        "query": "SELECT DISTINCT order_type FROM order_sla_breach_reporting ORDER BY 1"
      },
      {
        "name": "breach_scope",
        "type": "custom",
        "query": "REALTIME,HISTORICAL",
        "current": { "text": "HISTORICAL", "value": "HISTORICAL" }
      }
    ]
  },
  "time": { "from": "now-30d", "to": "now" },
  "timezone": "",
  "title": "SLA Breach Monitoring (Pick / Stage Started / Stage Completed / Ship)",
  "uid": "SLA_BREACH_VALUE_MAPPING_FINAL",
  "version": 6
}
