{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 100,
      "panels": [],
      "title": "Overview",
      "type": "row"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": 0 },
              { "color": "red", "value": 80 }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 1 },
      "id": 1,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": { "calcs": ["last"], "fields": "", "values": false },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.3.0",
      "targets": [
        {
          "datasource": "${ds}",
          "format": "table",
          "rawSql": "SELECT COUNT(DISTINCT order_line_id) AS count FROM order_status_history osh LEFT JOIN order_type_master otm ON osh.order_type_id = otm.id WHERE $__timeFilter(osh.entered_date) AND (otm.name ~ '${order_type:regex}' OR '${order_type:regex}' = '.*')",
          "refId": "A"
        }
      ],
      "title": "Order Lines (Range)",
      "type": "stat"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "auto",
            "showValues": false,
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 18, "x": 6, "y": 1 },
      "id": 2,
      "options": {
        "legend": { "calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true },
        "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" }
      },
      "pluginVersion": "12.3.0",
      "targets": [
        {
          "datasource": "${ds}",
          "alias": "Orders",
          "format": "time_series",
          "rawSql": "SELECT $__timeGroup(osh.entered_date, $__interval) AS time, COUNT(DISTINCT osh.order_id) AS value FROM order_status_history osh LEFT JOIN order_type_master otm ON osh.order_type_id = otm.id WHERE $__timeFilter(osh.entered_date) AND (otm.name ~ '${order_type:regex}' OR '${order_type:regex}' = '.*') GROUP BY 1 ORDER BY 1",
          "refId": "A"
        }
      ],
      "title": "Orders per Interval",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 9 },
      "id": 101,
      "panels": [],
      "title": "SLA Performance Metrics",
      "type": "row"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "auto",
            "showValues": false,
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 10 },
      "id": 3,
      "options": {
        "legend": { "calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true },
        "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" }
      },
      "pluginVersion": "12.3.0",
      "targets": [
        {
          "datasource": "${ds}",
          "alias": "Pick SLA Met %",
          "format": "time_series",
          "rawSql": "SELECT $__timeGroup(osh.entered_date, $__interval) AS time, 100.0 * COUNT(*) FILTER (WHERE osh.sla_met = true)::float / NULLIF(COUNT(*), 0) AS value FROM order_status_history osh LEFT JOIN order_type_master otm ON osh.order_type_id = otm.id WHERE $__timeFilter(osh.entered_date) AND osh.status = 'picked' AND (otm.name ~ '${order_type:regex}' OR '${order_type:regex}' = '.*') GROUP BY 1 ORDER BY 1",
          "refId": "A"
        }
      ],
      "title": "Pick SLA Met %",
      "type": "timeseries"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "auto",
            "showValues": false,
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 10 },
      "id": 4,
      "options": {
        "legend": { "calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true },
        "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" }
      },
      "pluginVersion": "12.3.0",
      "targets": [
        {
          "datasource": "${ds}",
          "alias": "Stage SLA Met %",
          "format": "time_series",
          "rawSql": "SELECT $__timeGroup(osh.entered_date, $__interval) AS time, 100.0 * COUNT(*) FILTER (WHERE osh.sla_met = true)::float / NULLIF(COUNT(*), 0) AS value FROM order_status_history osh LEFT JOIN order_type_master otm ON osh.order_type_id = otm.id WHERE $__timeFilter(osh.entered_date) AND osh.status = 'staged' AND (otm.name ~ '${order_type:regex}' OR '${order_type:regex}' = '.*') GROUP BY 1 ORDER BY 1",
          "refId": "A"
        }
      ],
      "title": "Stage SLA Met %",
      "type": "timeseries"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "auto",
            "showValues": false,
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 10 },
      "id": 5,
      "options": {
        "legend": { "calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true },
        "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" }
      },
      "pluginVersion": "12.3.0",
      "targets": [
        {
          "datasource": "${ds}",
          "alias": "Stage Complete SLA Met %",
          "format": "time_series",
          "rawSql": "SELECT $__timeGroup(osh.entered_date, $__interval) AS time, 100.0 * COUNT(*) FILTER (WHERE osh.sla_met = true)::float / NULLIF(COUNT(*), 0) AS value FROM order_status_history osh LEFT JOIN order_type_master otm ON osh.order_type_id = otm.id WHERE $__timeFilter(osh.entered_date) AND osh.status = 'stage_complete' AND (otm.name ~ '${order_type:regex}' OR '${order_type:regex}' = '.*') GROUP BY 1 ORDER BY 1",
          "refId": "A"
        }
      ],
      "title": "Stage Complete SLA Met %",
      "type": "timeseries"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "auto",
            "showValues": false,
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 18 },
      "id": 6,
      "options": {
        "legend": { "calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true },
        "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" }
      },
      "pluginVersion": "12.3.0",
      "targets": [
        {
          "datasource": "${ds}",
          "alias": "Ship SLA Met %",
          "format": "time_series",
          "rawSql": "SELECT $__timeGroup(osh.entered_date, $__interval) AS time, 100.0 * COUNT(*) FILTER (WHERE osh.sla_met = true)::float / NULLIF(COUNT(*), 0) AS value FROM order_status_history osh LEFT JOIN order_type_master otm ON osh.order_type_id = otm.id WHERE $__timeFilter(osh.entered_date) AND osh.status = 'shipped' AND (otm.name ~ '${order_type:regex}' OR '${order_type:regex}' = '.*') GROUP BY 1 ORDER BY 1",
          "refId": "A"
        }
      ],
      "title": "Ship SLA Met %",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 26 },
      "id": 102,
      "panels": [],
      "title": "SLA Breaches Analysis",
      "type": "row"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 8,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 0,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": false,
            "stacking": { "group": "breaches", "mode": "normal" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": []
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 27 },
      "id": 7,
      "options": {
        "legend": { "calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true },
        "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" }
      },
      "pluginVersion": "12.3.0",
      "targets": [
        {
          "datasource": "${ds}",
          "alias": "Pick Breaches",
          "format": "time_series",
          "rawSql": "WITH s AS (SELECT ol.order_date, (EXTRACT(EPOCH FROM (ol.pick_complete_date - ol.order_date))/60.0) AS pick_elapsed, sla.pick_sla_minutes AS pick_sla FROM order_lines ol CROSS JOIN LATERAL get_sla_for_order(ol.order_type, ol.order_date) AS sla(pick_sla_minutes, stage_sla_minutes, stage_complete_sla_minutes, pack_sla_minutes, ship_sla_minutes) WHERE $__timeFilter(ol.order_date) AND ol.order_type ~ '${order_type:regex}'), agg AS (SELECT $__timeGroup(order_date, $__interval) AS time, SUM((pick_elapsed > pick_sla)::int) AS breaches FROM s GROUP BY 1) SELECT time, breaches AS \"Pick Breaches\" FROM agg ORDER BY time",
          "refId": "A"
        },
        {
          "datasource": "${ds}",
          "alias": "Stage Breaches",
          "format": "time_series",
          "rawSql": "WITH s AS (SELECT ol.order_date, (EXTRACT(EPOCH FROM (ol.stage_complete_date - ol.order_date))/60.0) AS stage_elapsed, sla.stage_sla_minutes AS stage_sla FROM order_lines ol CROSS JOIN LATERAL get_sla_for_order(ol.order_type, ol.order_date) AS sla(pick_sla_minutes, stage_sla_minutes, stage_complete_sla_minutes, pack_sla_minutes, ship_sla_minutes) WHERE $__timeFilter(ol.order_date) AND ol.order_type ~ '${order_type:regex}'), agg AS (SELECT $__timeGroup(order_date, $__interval) AS time, SUM((stage_elapsed > stage_sla)::int) AS breaches FROM s GROUP BY 1) SELECT time, breaches AS \"Stage Breaches\" FROM agg ORDER BY time",
          "refId": "B"
        },
        {
          "datasource": "${ds}",
          "alias": "Ship Breaches",
          "format": "time_series",
          "rawSql": "WITH s AS (SELECT ol.order_date, (EXTRACT(EPOCH FROM (ol.ship_date - ol.order_date))/60.0) AS ship_elapsed, sla.ship_sla_minutes AS ship_sla FROM order_lines ol CROSS JOIN LATERAL get_sla_for_order(ol.order_type, ol.order_date) AS sla(pick_sla_minutes, stage_sla_minutes, stage_complete_sla_minutes, pack_sla_minutes, ship_sla_minutes) WHERE $__timeFilter(ol.order_date) AND ol.order_type ~ '${order_type:regex}'), agg AS (SELECT $__timeGroup(order_date, $__interval) AS time, SUM((ship_elapsed > ship_sla)::int) AS breaches FROM s GROUP BY 1) SELECT time, breaches AS \"Ship Breaches\" FROM agg ORDER BY time",
          "refId": "C"
        },
        {
          "datasource": "${ds}",
          "alias": "Stage Complete Breaches",
          "format": "time_series",
          "rawSql": "WITH s AS (SELECT ol.order_date, (EXTRACT(EPOCH FROM (ol.stage_complete_date - ol.stage_start_date))/60.0) AS stage_complete_elapsed, sla.stage_complete_sla_minutes AS stage_complete_sla FROM order_lines ol CROSS JOIN LATERAL get_sla_for_order(ol.order_type, ol.order_date) AS sla(pick_sla_minutes, stage_sla_minutes, stage_complete_sla_minutes, pack_sla_minutes, ship_sla_minutes) WHERE $__timeFilter(ol.order_date) AND ol.order_type ~ '${order_type:regex}' AND ol.stage_start_date IS NOT NULL AND ol.stage_complete_date IS NOT NULL AND sla.stage_complete_sla_minutes IS NOT NULL), agg AS (SELECT $__timeGroup(order_date, $__interval) AS time, SUM((stage_complete_elapsed > stage_complete_sla)::int) AS breaches FROM s GROUP BY 1) SELECT time, breaches AS \"Stage Complete Breaches\" FROM agg ORDER BY time",
          "refId": "D"
        }
      ],
      "title": "Breaches Over Time (Pick/Stage/Ship/Stage Complete)",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 35 },
      "id": 103,
      "panels": [],
      "title": "Order Type Analysis",
      "type": "row"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": { "defaults": { "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] } }, "overrides": [] },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 36 },
      "id": 8,
      "options": { "cellHeight": "sm", "showHeader": true },
      "pluginVersion": "12.3.0",
      "targets": [
        {
          "datasource": "${ds}",
          "format": "table",
          "rawSql": "WITH s AS (SELECT ol.order_type, ol.order_date, (EXTRACT(EPOCH FROM (ol.pick_complete_date - ol.order_date))/60.0) AS pick_elapsed, sla.pick_sla_minutes AS pick_sla, (EXTRACT(EPOCH FROM (ol.stage_complete_date - ol.order_date))/60.0) AS stage_elapsed, sla.stage_sla_minutes AS stage_sla, (EXTRACT(EPOCH FROM (ol.ship_date - ol.order_date))/60.0) AS ship_elapsed, sla.ship_sla_minutes AS ship_sla FROM order_lines ol CROSS JOIN LATERAL get_sla_for_order(ol.order_type, ol.order_date) AS sla(pick_sla_minutes, stage_sla_minutes, stage_complete_sla_minutes, pack_sla_minutes, ship_sla_minutes) WHERE $__timeFilter(ol.order_date) AND ol.order_type ~ '${order_type:regex}') SELECT order_type, COUNT(*) AS total, ROUND(100.0 * AVG((pick_elapsed <= pick_sla)::int)::numeric,2) AS pick_met_pct, ROUND(100.0 * AVG((stage_elapsed <= stage_sla)::int)::numeric,2) AS stage_met_pct, ROUND(100.0 * AVG((ship_elapsed <= ship_sla)::int)::numeric,2) AS ship_met_pct FROM s GROUP BY order_type ORDER BY order_type",
          "refId": "A"
        }
      ],
      "title": "SLA Summary by Order Type",
      "type": "table"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": { "defaults": { "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] } }, "overrides": [] },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 36 },
      "id": 9,
      "options": { "cellHeight": "sm", "showHeader": true },
      "pluginVersion": "12.3.0",
      "targets": [
        {
          "datasource": "${ds}",
          "format": "table",
          "rawSql": "SELECT ol.order_type, COUNT(*) AS count FROM order_lines ol WHERE $__timeFilter(ol.order_date) AND ol.order_type ~ '${order_type:regex}' GROUP BY ol.order_type ORDER BY count DESC",
          "refId": "A"
        }
      ],
      "title": "Orders by Order Type",
      "type": "table"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 44 },
      "id": 104,
      "panels": [],
      "title": "Lead Time & Operational Metrics",
      "type": "row"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": { "defaults": { "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] } }, "overrides": [] },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 45 },
      "id": 10,
      "options": { "cellHeight": "sm", "showHeader": true },
      "pluginVersion": "12.3.0",
      "targets": [
        {
          "datasource": "${ds}",
          "format": "table",
          "rawSql": "SELECT ROUND(percentile_disc(0.5) WITHIN GROUP (ORDER BY (EXTRACT(EPOCH FROM (ol.ship_date - ol.order_date))/60.0))::numeric,2) AS p50_min, ROUND(percentile_disc(0.9) WITHIN GROUP (ORDER BY (EXTRACT(EPOCH FROM (ol.ship_date - ol.order_date))/60.0))::numeric,2) AS p90_min, ROUND(percentile_disc(0.99) WITHIN GROUP (ORDER BY (EXTRACT(EPOCH FROM (ol.ship_date - ol.order_date))/60.0))::numeric,2) AS p99_min FROM order_lines ol WHERE $__timeFilter(ol.order_date) AND ol.order_type ~ '${order_type:regex}' AND ol.ship_date IS NOT NULL",
          "refId": "A"
        }
      ],
      "title": "Ship Lead Time Percentiles (min)",
      "type": "table"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": { "defaults": { "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] } }, "overrides": [] },
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 45 },
      "id": 11,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["last"], "fields": "", "values": false },
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.3.0",
      "targets": [
        {
          "datasource": "${ds}",
          "format": "table",
          "rawSql": "SELECT ROUND(AVG(EXTRACT(EPOCH FROM (ol.ship_date - ol.order_date))/60.0)::numeric,2) AS value FROM order_lines ol WHERE $__timeFilter(ol.order_date) AND ol.order_type ~ '${order_type:regex}' AND ol.ship_date IS NOT NULL",
          "refId": "A"
        }
      ],
      "title": "Avg Ship Lead Time (min)",
      "type": "stat"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": { "defaults": { "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] } }, "overrides": [] },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 51 },
      "id": 12,
      "options": { "cellHeight": "sm", "showHeader": true },
      "pluginVersion": "12.3.0",
      "targets": [
        {
          "datasource": "${ds}",
          "format": "table",
          "rawSql": "SELECT 'Picking' AS stage, COUNT(*) AS count FROM order_lines ol WHERE ol.pick_start_date IS NOT NULL AND ol.pick_complete_date IS NULL AND $__timeFilter(ol.order_date) UNION ALL SELECT 'Staging' AS stage, COUNT(*) FROM order_lines ol WHERE ol.stage_start_date IS NOT NULL AND ol.stage_complete_date IS NULL AND $__timeFilter(ol.order_date) UNION ALL SELECT 'Packing' AS stage, COUNT(*) FROM order_lines ol WHERE ol.pack_start_date IS NOT NULL AND ol.pack_complete_date IS NULL AND $__timeFilter(ol.order_date) UNION ALL SELECT 'Ready to Ship' AS stage, COUNT(*) FROM order_lines ol WHERE ol.pack_complete_date IS NOT NULL AND ol.ship_date IS NULL AND $__timeFilter(ol.order_date) UNION ALL SELECT 'Shipped' AS stage, COUNT(*) FROM order_lines ol WHERE ol.ship_date IS NOT NULL AND $__timeFilter(ol.order_date)",
          "refId": "A"
        }
      ],
      "title": "WIP by Stage (Current in Range)",
      "type": "table"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": { "defaults": { "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] } }, "overrides": [] },
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 51 },
      "id": 13,
      "options": { "cellHeight": "sm", "showHeader": true },
      "pluginVersion": "12.3.0",
      "targets": [
        {
          "datasource": "${ds}",
          "format": "table",
          "rawSql": "WITH s AS (SELECT CASE WHEN EXTRACT(HOUR FROM ol.order_date) < 13 THEN 'Before 13:00' ELSE 'After 13:00' END AS bucket, (EXTRACT(EPOCH FROM (ol.stage_complete_date - ol.order_date))/60.0) AS stage_elapsed, sla.stage_sla_minutes AS stage_sla FROM order_lines ol CROSS JOIN LATERAL get_sla_for_order(ol.order_type, ol.order_date) AS sla(pick_sla_minutes, stage_sla_minutes, stage_complete_sla_minutes, pack_sla_minutes, ship_sla_minutes) WHERE $__timeFilter(ol.order_date) AND ol.order_type = 'Rock Auto') SELECT bucket, COUNT(*) AS total, ROUND(100.0 * AVG((stage_elapsed <= stage_sla)::int)::numeric,2) AS stage_met_pct FROM s GROUP BY bucket ORDER BY bucket",
          "refId": "A"
        }
      ],
      "title": "Rock Auto Stage SLA: Before vs After 13:00",
      "type": "table"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 57 },
      "id": 105,
      "panels": [],
      "title": "Additional Stage Metrics",
      "type": "row"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "auto",
            "showValues": false,
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 58 },
      "id": 14,
      "options": {
        "legend": { "calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true },
        "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" }
      },
      "pluginVersion": "12.3.0",
      "targets": [
        {
          "datasource": "${ds}",
          "alias": "Stage Complete SLA Met %",
          "format": "time_series",
          "rawSql": "WITH s AS (SELECT ol.order_date, ol.order_type, (EXTRACT(EPOCH FROM (ol.stage_complete_date - ol.stage_start_date))/60.0) AS stage_complete_elapsed, sla.stage_complete_sla_minutes AS stage_complete_sla FROM order_lines ol CROSS JOIN LATERAL get_sla_for_order(ol.order_type, ol.order_date) AS sla(pick_sla_minutes, stage_sla_minutes, stage_complete_sla_minutes, pack_sla_minutes, ship_sla_minutes) WHERE $__timeFilter(ol.order_date) AND ol.order_type ~ '${order_type:regex}' AND ol.stage_start_date IS NOT NULL AND ol.stage_complete_date IS NOT NULL AND sla.stage_complete_sla_minutes IS NOT NULL), agg AS (SELECT $__timeGroup(order_date, $__interval) AS time, SUM((stage_complete_elapsed > stage_complete_sla)::int) AS breaches, COUNT(*) AS total FROM s GROUP BY 1) SELECT time, 100.0 * (total - breaches)::float / NULLIF(total,0) AS value FROM agg ORDER BY time",
          "refId": "A"
        }
      ],
      "title": "Stage Complete SLA Met %",
      "type": "timeseries"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "auto",
            "showValues": false,
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 58 },
      "id": 15,
      "options": {
        "legend": { "calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true },
        "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" }
      },
      "pluginVersion": "12.3.0",
      "targets": [
        {
          "datasource": "${ds}",
          "alias": "Pack SLA Met %",
          "format": "time_series",
          "rawSql": "WITH s AS (SELECT ol.order_date, ol.order_type, (EXTRACT(EPOCH FROM (ol.pack_complete_date - ol.pack_start_date))/60.0) AS pack_elapsed, sla.pack_sla_minutes AS pack_sla FROM order_lines ol CROSS JOIN LATERAL get_sla_for_order(ol.order_type, ol.order_date) AS sla(pick_sla_minutes, stage_sla_minutes, stage_complete_sla_minutes, pack_sla_minutes, ship_sla_minutes) WHERE $__timeFilter(ol.order_date) AND ol.order_type ~ '${order_type:regex}' AND ol.pack_start_date IS NOT NULL AND ol.pack_complete_date IS NOT NULL AND sla.pack_sla_minutes IS NOT NULL), agg AS (SELECT $__timeGroup(order_date, $__interval) AS time, SUM((pack_elapsed > pack_sla)::int) AS breaches, COUNT(*) AS total FROM s GROUP BY 1) SELECT time, 100.0 * (total - breaches)::float / NULLIF(total,0) AS value FROM agg ORDER BY time",
          "refId": "A"
        }
      ],
      "title": "Pack SLA Met %",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 66 },
      "id": 106,
      "panels": [],
      "title": "SLA Met vs Breach Comparison",
      "type": "row"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "lineWidth": 1,
            "scaleDistribution": { "type": "linear" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null }
            ]
          },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Pick SLA Met" },
            "properties": [
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "green" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Pick Breaches" },
            "properties": [
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "red" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Stage SLA Met" },
            "properties": [
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "green" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Stage Breaches" },
            "properties": [
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "red" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Stage Complete SLA Met" },
            "properties": [
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "green" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Stage Complete Breaches" },
            "properties": [
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "red" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Pack SLA Met" },
            "properties": [
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "green" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Pack Breaches" },
            "properties": [
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "red" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Ship SLA Met" },
            "properties": [
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "green" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Ship Breaches" },
            "properties": [
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "red" } }
            ]
          }
        ]
      },
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 67 },
      "id": 18,
      "options": {
        "barRadius": 0,
        "barWidth": 0.8,
        "colorByField": null,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": { "calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true },
        "orientation": "auto",
        "showValue": "auto",
        "stacking": "none",
        "tooltip": { "mode": "single", "sort": "none" },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 0
      },
      "pluginVersion": "12.3.0",
      "targets": [
        {
          "datasource": "${ds}",
          "format": "table",
          "rawSql": "WITH base AS (SELECT ol.*, sla.pick_sla_minutes, sla.stage_sla_minutes, sla.stage_complete_sla_minutes, sla.pack_sla_minutes, sla.ship_sla_minutes FROM order_lines ol CROSS JOIN LATERAL get_sla_for_order(ol.order_type, ol.order_date) AS sla(pick_sla_minutes, stage_sla_minutes, stage_complete_sla_minutes, pack_sla_minutes, ship_sla_minutes) WHERE $__timeFilter(ol.order_date) AND ol.order_type ~ '${order_type:regex}'), pick AS (SELECT SUM(CASE WHEN pick_complete_date IS NOT NULL AND pick_sla_minutes IS NOT NULL AND (EXTRACT(EPOCH FROM (pick_complete_date - order_date))/60.0) <= pick_sla_minutes THEN 1 ELSE 0 END) AS met, SUM(CASE WHEN pick_complete_date IS NOT NULL AND pick_sla_minutes IS NOT NULL AND (EXTRACT(EPOCH FROM (pick_complete_date - order_date))/60.0) > pick_sla_minutes THEN 1 ELSE 0 END) AS breach FROM base), stage AS (SELECT SUM(CASE WHEN stage_complete_date IS NOT NULL AND stage_sla_minutes IS NOT NULL AND (EXTRACT(EPOCH FROM (stage_complete_date - order_date))/60.0) <= stage_sla_minutes THEN 1 ELSE 0 END) AS met, SUM(CASE WHEN stage_complete_date IS NOT NULL AND stage_sla_minutes IS NOT NULL AND (EXTRACT(EPOCH FROM (stage_complete_date - order_date))/60.0) > stage_sla_minutes THEN 1 ELSE 0 END) AS breach FROM base), stage_complete AS (SELECT SUM(CASE WHEN stage_start_date IS NOT NULL AND stage_complete_date IS NOT NULL AND stage_complete_sla_minutes IS NOT NULL AND (EXTRACT(EPOCH FROM (stage_complete_date - stage_start_date))/60.0) <= stage_complete_sla_minutes THEN 1 ELSE 0 END) AS met, SUM(CASE WHEN stage_start_date IS NOT NULL AND stage_complete_date IS NOT NULL AND stage_complete_sla_minutes IS NOT NULL AND (EXTRACT(EPOCH FROM (stage_complete_date - stage_start_date))/60.0) > stage_complete_sla_minutes THEN 1 ELSE 0 END) AS breach FROM base), pack AS (SELECT SUM(CASE WHEN pack_start_date IS NOT NULL AND pack_complete_date IS NOT NULL AND pack_sla_minutes IS NOT NULL AND (EXTRACT(EPOCH FROM (pack_complete_date - pack_start_date))/60.0) <= pack_sla_minutes THEN 1 ELSE 0 END) AS met, SUM(CASE WHEN pack_start_date IS NOT NULL AND pack_complete_date IS NOT NULL AND pack_sla_minutes IS NOT NULL AND (EXTRACT(EPOCH FROM (pack_complete_date - pack_start_date))/60.0) > pack_sla_minutes THEN 1 ELSE 0 END) AS breach FROM base), ship AS (SELECT SUM(CASE WHEN ship_date IS NOT NULL AND ship_sla_minutes IS NOT NULL AND (EXTRACT(EPOCH FROM (ship_date - order_date))/60.0) <= ship_sla_minutes THEN 1 ELSE 0 END) AS met, SUM(CASE WHEN ship_date IS NOT NULL AND ship_sla_minutes IS NOT NULL AND (EXTRACT(EPOCH FROM (ship_date - order_date))/60.0) > ship_sla_minutes THEN 1 ELSE 0 END) AS breach FROM base) SELECT 'Pick' AS stage, pick.met AS \"Pick SLA Met\", pick.breach AS \"Pick Breaches\" FROM pick UNION ALL SELECT 'Stage' AS stage, stage.met AS \"Stage SLA Met\", stage.breach AS \"Stage Breaches\" FROM stage UNION ALL SELECT 'Stage Complete' AS stage, stage_complete.met AS \"Stage Complete SLA Met\", stage_complete.breach AS \"Stage Complete Breaches\" FROM stage_complete UNION ALL SELECT 'Pack' AS stage, pack.met AS \"Pack SLA Met\", pack.breach AS \"Pack Breaches\" FROM pack UNION ALL SELECT 'Ship' AS stage, ship.met AS \"Ship SLA Met\", ship.breach AS \"Ship Breaches\" FROM ship",
          "refId": "A"
        }
      ],
      "title": "SLA Met vs Breaches by Stage",
      "type": "barchart"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 77 },
      "id": 107,
      "panels": [],
      "title": "Comprehensive Breach & Summary Views",
      "type": "row"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 8,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 0,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": false,
            "stacking": { "group": "breaches_all", "mode": "normal" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": []
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 78 },
      "id": 16,
      "options": {
        "legend": { "calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true },
        "tooltip": { "hideZeros": false, "mode": "single", "sort": "none" }
      },
      "pluginVersion": "12.3.0",
      "targets": [
        { "datasource": "${ds}", "alias": "Pick Breaches", "format": "time_series", "refId": "A", "rawSql": "WITH s AS (SELECT ol.order_date, (EXTRACT(EPOCH FROM (ol.pick_complete_date - ol.order_date))/60.0) AS pick_elapsed, sla.pick_sla_minutes AS pick_sla FROM order_lines ol CROSS JOIN LATERAL get_sla_for_order(ol.order_type, ol.order_date) AS sla(pick_sla_minutes, stage_sla_minutes, stage_complete_sla_minutes, pack_sla_minutes, ship_sla_minutes) WHERE $__timeFilter(ol.order_date) AND ol.order_type ~ '${order_type:regex}'), agg AS (SELECT $__timeGroup(order_date, $__interval) AS time, SUM((pick_elapsed > pick_sla)::int) AS breaches FROM s GROUP BY 1) SELECT time, breaches AS \"Pick Breaches\" FROM agg ORDER BY time" },
        { "datasource": "${ds}", "alias": "Stage Breaches", "format": "time_series", "refId": "B", "rawSql": "WITH s AS (SELECT ol.order_date, (EXTRACT(EPOCH FROM (ol.stage_complete_date - ol.order_date))/60.0) AS stage_elapsed, sla.stage_sla_minutes AS stage_sla FROM order_lines ol CROSS JOIN LATERAL get_sla_for_order(ol.order_type, ol.order_date) AS sla(pick_sla_minutes, stage_sla_minutes, stage_complete_sla_minutes, pack_sla_minutes, ship_sla_minutes) WHERE $__timeFilter(ol.order_date) AND ol.order_type ~ '${order_type:regex}'), agg AS (SELECT $__timeGroup(order_date, $__interval) AS time, SUM((stage_elapsed > stage_sla)::int) AS breaches FROM s GROUP BY 1) SELECT time, breaches AS \"Stage Breaches\" FROM agg ORDER BY time" },
        { "datasource": "${ds}", "alias": "Stage Complete Breaches", "format": "time_series", "refId": "C", "rawSql": "WITH s AS (SELECT ol.order_date, (EXTRACT(EPOCH FROM (ol.stage_complete_date - ol.stage_start_date))/60.0) AS stage_complete_elapsed, sla.stage_complete_sla_minutes AS stage_complete_sla FROM order_lines ol CROSS JOIN LATERAL get_sla_for_order(ol.order_type, ol.order_date) AS sla(pick_sla_minutes, stage_sla_minutes, stage_complete_sla_minutes, pack_sla_minutes, ship_sla_minutes) WHERE $__timeFilter(ol.order_date) AND ol.order_type ~ '${order_type:regex}' AND ol.stage_start_date IS NOT NULL AND ol.stage_complete_date IS NOT NULL AND sla.stage_complete_sla_minutes IS NOT NULL), agg AS (SELECT $__timeGroup(order_date, $__interval) AS time, SUM((stage_complete_elapsed > stage_complete_sla)::int) AS breaches FROM s GROUP BY 1) SELECT time, breaches AS \"Stage Complete Breaches\" FROM agg ORDER BY time" },
        { "datasource": "${ds}", "alias": "Pack Breaches", "format": "time_series", "refId": "D", "rawSql": "WITH s AS (SELECT ol.order_date, (EXTRACT(EPOCH FROM (ol.pack_complete_date - ol.pack_start_date))/60.0) AS pack_elapsed, sla.pack_sla_minutes AS pack_sla FROM order_lines ol CROSS JOIN LATERAL get_sla_for_order(ol.order_type, ol.order_date) AS sla(pick_sla_minutes, stage_sla_minutes, stage_complete_sla_minutes, pack_sla_minutes, ship_sla_minutes) WHERE $__timeFilter(ol.order_date) AND ol.order_type ~ '${order_type:regex}' AND ol.pack_start_date IS NOT NULL AND ol.pack_complete_date IS NOT NULL AND sla.pack_sla_minutes IS NOT NULL), agg AS (SELECT $__timeGroup(order_date, $__interval) AS time, SUM((pack_elapsed > pack_sla)::int) AS breaches FROM s GROUP BY 1) SELECT time, breaches AS \"Pack Breaches\" FROM agg ORDER BY time" },
        { "datasource": "${ds}", "alias": "Ship Breaches", "format": "time_series", "refId": "E", "rawSql": "WITH s AS (SELECT ol.order_date, (EXTRACT(EPOCH FROM (ol.ship_date - ol.order_date))/60.0) AS ship_elapsed, sla.ship_sla_minutes AS ship_sla FROM order_lines ol CROSS JOIN LATERAL get_sla_for_order(ol.order_type, ol.order_date) AS sla(pick_sla_minutes, stage_sla_minutes, stage_complete_sla_minutes, pack_sla_minutes, ship_sla_minutes) WHERE $__timeFilter(ol.order_date) AND ol.order_type ~ '${order_type:regex}'), agg AS (SELECT $__timeGroup(order_date, $__interval) AS time, SUM((ship_elapsed > ship_sla)::int) AS breaches FROM s GROUP BY 1) SELECT time, breaches AS \"Ship Breaches\" FROM agg ORDER BY time" }
      ],
      "title": "Breaches Over Time (All Stages)",
      "type": "timeseries"
    },
    {
      "datasource": "${ds}",
      "fieldConfig": { "defaults": { "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": 0 }, { "color": "red", "value": 80 } ] } }, "overrides": [] },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 86 },
      "id": 17,
      "options": { "cellHeight": "sm", "showHeader": true },
      "pluginVersion": "12.3.0",
      "targets": [
        {
          "datasource": "${ds}",
          "format": "table",
          "rawSql": "WITH base AS (SELECT ol.*, sla.pick_sla_minutes, sla.stage_sla_minutes, sla.stage_complete_sla_minutes, sla.pack_sla_minutes, sla.ship_sla_minutes FROM order_lines ol CROSS JOIN LATERAL get_sla_for_order(ol.order_type, ol.order_date) AS sla(pick_sla_minutes, stage_sla_minutes, stage_complete_sla_minutes, pack_sla_minutes, ship_sla_minutes) WHERE $__timeFilter(ol.order_date) AND ol.order_type ~ '${order_type:regex}') SELECT ROUND(100.0 * AVG(CASE WHEN pick_complete_date IS NOT NULL AND pick_sla_minutes IS NOT NULL THEN CASE WHEN (EXTRACT(EPOCH FROM (pick_complete_date - order_date))/60.0) <= pick_sla_minutes THEN 1 ELSE 0 END END)::numeric,2) AS pick_met_pct, ROUND(100.0 * AVG(CASE WHEN stage_complete_date IS NOT NULL AND stage_sla_minutes IS NOT NULL THEN CASE WHEN (EXTRACT(EPOCH FROM (stage_complete_date - order_date))/60.0) <= stage_sla_minutes THEN 1 ELSE 0 END END)::numeric,2) AS stage_met_pct, ROUND(100.0 * AVG(CASE WHEN stage_start_date IS NOT NULL AND stage_complete_date IS NOT NULL AND stage_complete_sla_minutes IS NOT NULL THEN CASE WHEN (EXTRACT(EPOCH FROM (stage_complete_date - stage_start_date))/60.0) <= stage_complete_sla_minutes THEN 1 ELSE 0 END END)::numeric,2) AS stage_complete_met_pct, ROUND(100.0 * AVG(CASE WHEN pack_start_date IS NOT NULL AND pack_complete_date IS NOT NULL AND pack_sla_minutes IS NOT NULL THEN CASE WHEN (EXTRACT(EPOCH FROM (pack_complete_date - pack_start_date))/60.0) <= pack_sla_minutes THEN 1 ELSE 0 END END)::numeric,2) AS pack_met_pct, ROUND(100.0 * AVG(CASE WHEN ship_date IS NOT NULL AND ship_sla_minutes IS NOT NULL THEN CASE WHEN (EXTRACT(EPOCH FROM (ship_date - order_date))/60.0) <= ship_sla_minutes THEN 1 ELSE 0 END END)::numeric,2) AS ship_met_pct FROM base",
          "refId": "A"
        }
      ],
      "title": "SLA Met % by Stage (Overall)",
      "type": "table"
    }
  ],
  "preload": false,
  "refresh": "30s",
  "schemaVersion": 42,
  "tags": ["sla", "orders"],
  "templating": {
    "list": [
      {
        "name": "ds",
        "label": "Data source",
        "type": "datasource",
        "query": "postgres",
        "current": { "text": "sla_analytics", "value": "sla_analytics" }
      },
      {
        "name": "order_type",
        "label": "Order Type",
        "type": "query",
        "datasource": "${ds}",
        "query": "SELECT DISTINCT order_type FROM sla_config ORDER BY 1",
        "definition": "SELECT DISTINCT order_type FROM sla_config ORDER BY 1",
        "includeAll": true,
        "allValue": ".*",
        "multi": true,
        "refresh": 2,
        "current": { "text": ["All"], "value": [".*"] }
      }
    ]
  },
  "time": { "from": "now-24h", "to": "now" },
  "timepicker": {},
  "timezone": "",
  "title": "SLA Operations (Extended)",
  "uid": "sla-ops-ext",
  "version": 1
}
